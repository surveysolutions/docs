<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content><meta name=keywords content="installation,configuration,cloud,azure"><meta property="og:url" content="https://docs.mysurvey.solutions/headquarters/config/azure-setup/"><meta property="og:site_name" content="Survey Solutions | Documentation"><meta property="og:title" content="Azure setup"><meta property="og:description" content="Installation of Survey Solutions on Microsoft Azure In order to install - register on azure portal and login. Installation steps are going to use azure shell.
After loggedin into azure shell execute command with variables that are going to be needed later. Feel free to change them as you need:
RG=surveysolutions \ LOC=westeurope \ STOREACC=surveysolutions \ SHARE_NAME=surveysolutions \ PGSERVER=suso-postgres \ PGPASS=password \ WEBAPPNAME=surveysolutions-webapp \ SRVPLAN=AppSvc-SurveySolutions-plan RG - resource group where all survey solutions related resources are going to be grouped LOC - location where you will run survey solutions software. Choose the one that fits your needs https://azure.microsoft.com/en-us/global-infrastructure/geographies/ STOREACC - storage account that will contain binary data https://docs.microsoft.com/en-us/azure/storage/common/storage-account-overview. Should be unique so change it, do not use one provided here SHARE_NAME - name of file share for survey solutions to store binary data PGSERVER - name for PostgreSQL server PGPASS - password for PostgreSQL database change. Make your own password, do not use the one provided in here. WEBAPPNAME - address and name of created survey solutions intallation. Should be unique across all other web apps. SRVPLAN - name for created service plan Create a resource group:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="headquarters"><meta property="article:published_time" content="2020-11-03T12:00:00+00:00"><meta property="article:modified_time" content="2020-11-05T12:02:29+02:00"><meta property="og:image" content="https://docs.mysurvey.solutions/img/logo.png"><link rel=icon href=/img/favicon/favicon-support-1.png type=image/png sizes=16x16><link rel=icon href=/img/favicon/favicon-support-1-48-win-ico.png type=image/png sizes=48x48><link rel=icon href=/img/favicon/favicon-support-1-158-General-use-iOS-Android.png type=image/png sizes=152x152><link rel=icon href=/img/favicon/favicon-support-1-196-Chrome-for-Android.png type=image/png sizes=196x196><link rel=icon href=/img/favicon/favicon-support-1-558-win10-tile.png type=image/png sizes=558x558><title>Azure setup</title><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900&amp;subset=cyrillic,cyrillic-ext,greek,greek-ext,latin-ext,vietnamese" rel=stylesheet><link href=/css/all.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css rel=stylesheet></head><body><header class="px-md-3 pt-3"><div class=container><div class=row><div class="mb-3 col-lg-6 col-md-12"><a class="navbar-brand text-white pr-0 mr-0 float-left" href=https://mysurvey.solutions/ target=_blank><img src=/img/logo.png alt="Survey Solutions" class=float-left>
<span class="float-left ml-2">Survey<br>Solutions</span>
</a><a class="navbar-text text-white pl-sm-4 ml-sm-4 pl-2 ml-2 float-left" href=https://docs.mysurvey.solutions/>Documentation and knowledge base</a></div><script type=text/template id=my-custom-menu-template>
    <div class="aa">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="docs-tab" data-toggle="tab" href="#docs" role="tab" aria-controls="docs" aria-selected="true">Articles</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="forum-tab" data-toggle="tab" href="#forum" role="tab" aria-controls="forum" aria-selected="false">Forum topics</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="aa-dataset-docs tab-pane fade show active" id="docs" role="tabpanel" aria-labelledby="docs-tab"></div>
            <div class="aa-dataset-forum tab-pane fade" id="forum" role="tabpanel" aria-labelledby="forum-tab"></div>
        </div>
    </div>
</script><div class="col-lg-6 col-md-12 pt-2 mb-4 mb-lg-3"><form class=form-inline onsubmit=return!1><div class="input-group search"><input type=text class="form-control w-100" placeholder="Have a Question? Ask or enter a search term here." id=aa-search-input></div></form></div></div></div></header><main class="container mb-3"><nav aria-label=breadcrumb><ol class="breadcrumb bg-transparent pl-0"><li class=breadcrumb-item><a href=/>Home</a></li><li class=breadcrumb-item><a href=/headquarters/>Headquarters</a></li><li class=breadcrumb-item><a href=/headquarters/config/>Setup and Configuration</a></li><li class="breadcrumb-item active" aria-current=page>Azure setup</li></ol></nav><div class=mb-4><article class="article d-block w-100"><div class="mb-5 pb-1 d-block w-100 page-title d-flex align-items-end"><h2 class="mb-3 mr-auto pr-3">Azure setup</h2><div class="data text-right">November 5, 2020</div></div><div class=article-content><h1 id=installation-of-survey-solutions-on-microsoft-azure>Installation of Survey Solutions on Microsoft Azure</h1><p>In order to install - register on <a href=https://azure.microsoft.com/en-us/free/>azure portal</a> and login. Installation steps are going to use <a href=https://docs.microsoft.com/en-us/azure/cloud-shell/overview>azure shell</a>.</p><p>After loggedin into azure shell execute command with variables that are going to be needed later. Feel free to change them as you need:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>RG=surveysolutions <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>LOC=westeurope <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>STOREACC=surveysolutions <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>SHARE_NAME=surveysolutions <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>PGSERVER=suso-postgres <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>PGPASS=password <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>WEBAPPNAME=surveysolutions-webapp <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>SRVPLAN=AppSvc-SurveySolutions-plan
</span></span></code></pre></div><blockquote><ul><li><code>RG</code> - resource group where all survey solutions related resources are going to be grouped</li><li><code>LOC</code> - location where you will run survey solutions software. Choose the one that fits your needs <a href=https://azure.microsoft.com/en-us/global-infrastructure/geographies/>https://azure.microsoft.com/en-us/global-infrastructure/geographies/</a></li><li><code>STOREACC</code> - storage account that will contain binary data <a href=https://docs.microsoft.com/en-us/azure/storage/common/storage-account-overview>https://docs.microsoft.com/en-us/azure/storage/common/storage-account-overview</a>. Should be unique so change it, do not use one provided here</li><li><code>SHARE_NAME</code> - name of file share for survey solutions to store binary data</li><li><code>PGSERVER</code> - name for PostgreSQL server</li><li><code>PGPASS</code> - password for PostgreSQL database change. Make your own password, <strong>do not use the one provided in here</strong>.</li><li><code>WEBAPPNAME</code> - address and name of created survey solutions intallation. Should be unique across all other web apps.</li><li><code>SRVPLAN</code> - name for created <a href=https://docs.microsoft.com/en-us/azure/app-service/overview-hosting-plans>service plan</a></li></ul></blockquote><p>Create a resource group:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az group create --name $RG --location $LOC
</span></span></code></pre></div><p>Create PostgreSQL server instance:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az postgres server create -l $LOC  -g $RG -n $PGSERVER -u postgres -p $PGPASS <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>    --sku-name B_Gen5_2 --version 11
</span></span></code></pre></div><p>Allow connections from azure services to PostgreSQL:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az postgres server firewall-rule create -g $RG <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>    -s $PGSERVER -n <span style=color:#a31515>&#34;AllowAllWindowsAzureIps&#34;</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>    --start-ip-address <span style=color:#a31515>&#34;0.0.0.0&#34;</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>    --end-ip-address <span style=color:#a31515>&#34;0.0.0.0&#34;</span>
</span></span></code></pre></div><p>Create a storage account:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az storage account create -n $STOREACC -g $RG -l $LOC --sku Standard_LRS
</span></span></code></pre></div><p>Get store key for later use:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>STOREKEY=<span style=color:#00f>$(</span>az storage account keys list --account-name $STOREACC --query [0].value -o tsv<span style=color:#00f>)</span>
</span></span></code></pre></div><p>Create file share:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az storage share create <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>  --name $SHARE_NAME <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>  --account-key $STOREKEY <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>  --account-name $STOREACC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az storage share create <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>  --name $SHARE_NAME-logs <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>  --account-key $STOREKEY <span style=color:#a31515>\
</span></span></span><span style=display:flex><span>  --account-name $STOREACC
</span></span></code></pre></div><p>Create a service plan:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az appservice plan create --name $SRVPLAN --resource-group $RG --is-linux
</span></span></code></pre></div><p>Create a web application that will host survey solutions:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az webapp create --resource-group $RG --plan $SRVPLAN --name $WEBAPPNAME --deployment-container-image-name surveysolutions/surveysolutions:latest
</span></span></code></pre></div><p>Set required configuration properties for Survey Solutions:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>az webapp config appsettings set -g $RG -n $WEBAPPNAME --settings HQ_Headquarters__TenantName=hq 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az webapp config appsettings set -g $RG -n $WEBAPPNAME --settings HQ_Headquarters__BaseUrl=https://<span style=color:#a31515>${</span>WEBAPPNAME<span style=color:#a31515>}</span>.azurewebsites.net
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az webapp config appsettings set --resource-group $RG --name $WEBAPPNAME --settings HQ_ConnectionStrings__DefaultConnection=<span style=color:#a31515>&#34;Server=</span><span style=color:#a31515>${</span>PGSERVER<span style=color:#a31515>}</span><span style=color:#a31515>.postgres.database.azure.com;Database=SurveySolutions;Port=5432;User Id=postgres@</span><span style=color:#a31515>${</span>PGSERVER<span style=color:#a31515>}</span><span style=color:#a31515>;Password=</span><span style=color:#a31515>${</span>PGPASS<span style=color:#a31515>}</span><span style=color:#a31515>;Ssl Mode=Require;&#34;</span>
</span></span></code></pre></div><p>Mount file shares to docker image:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>az webapp config storage-account add --resource-group $RG --name $WEBAPPNAME --custom-id appdata --storage-type AzureFiles --share-name $SHARE_NAME --account-name $STOREACC --access-key $STOREKEY --mount-path /app/AppData
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az webapp config storage-account add --resource-group $RG --name $WEBAPPNAME --custom-id logs --storage-type AzureFiles --share-name $SHARE_NAME-logs --account-name $STOREACC --access-key $STOREKEY --mount-path /logs
</span></span></code></pre></div><p>Enable https redirect:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az webapp update -g $RG -n $WEBAPPNAME --https-only true
</span></span></code></pre></div><p>Now to make sure all changes take effect restart webapp:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az webapp restart --name $WEBAPPNAME --resource-group $RG
</span></span></code></pre></div><p>In order to see running instance execute command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#a31515>&#34;https://</span><span style=color:#00f>$(</span>az webapp list --query <span style=color:#a31515>&#34;[0].{hostName: defaultHostName}&#34;</span> -o tsv<span style=color:#00f>)</span><span style=color:#a31515>&#34;</span>
</span></span></code></pre></div><p>It will output address of your instance. Copy it from console to your browser application is up and running.</p><h2 id=post-installation-settings>Post installation settings</h2><p>Shown example creates smallest possible sku tier. It is enough to get started and do minor trainings, but its not recommended for production use. When you configured the software its possible to scaleup used App Service Plan. To do it find resource group you created in the beginning and find AppSvc-SurveySolutions-plan in the list (or name you gave to service plan). Here you can <a href=https://docs.microsoft.com/en-us/azure/app-service/overview-hosting-plans#what-if-my-app-needs-more-capabilities-or-features>change available resources</a> for Survey Solutions. On the overview tab you can see how much resources is consumed right now, so you can decide if its enough or not.</p><p>If you encreased app service plan resources but system still works slowly check if database instance keeps up with load. In same resources group find suso-postgres resource. On the overview tab you see resource utilization graph. See if current tier is enough for your load and scale up/down accordingly.</p><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-warning rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-header border-0 bg-white pl-3 text-warning"><h3>Warning:</h3></div><div class="card-body pt-1">Please note that changing to and from the Basic compute tier or changing the backup redundancy options after server creation is not supported for PostgreSQL database. So if you plan a large scale survey start with general purpose instance at the beginning.</div></div></div></div></article></div></main><footer class="footer pt-3 pb-1 px-sm-3 px-lg-0"><div class="container copyright"><div class=float-left>&#169; 2016-2025 The World Bank Group.<br>All rights Reserved. <a href=https://www.worldbank.org/en/about/legal _target=blank>Legal</a><br><a class=text-primary href=/about/ _target=blank><b class=text-primary>About the team</b></a>
<a class=text-primary href=https://www.capterra.com/p/153927/Survey-Solutions/ target=_blank>Testimonials</a></div></div></footer><script src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js></script><script src=https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js></script><script src=/js/asearch.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js></script><script>$(document).on("click",'[data-toggle="lightbox"]',function(e){e.preventDefault(),$(this).ekkoLightbox({alwaysShowClose:!0})})</script></body></html>